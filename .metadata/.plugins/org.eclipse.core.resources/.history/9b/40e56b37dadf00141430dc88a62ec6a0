package ru.kpfu.itis.group403.yuskevich.fileManager.commands;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.nio.file.NoSuchFileException;
import java.util.Scanner;

import ru.kpfu.itis.group403.yuskevich.fileManager.classes.Tool;
import ru.kpfu.itis.group403.yuskevich.fileManager.classes.WrongInputException;
import ru.kpfu.itis.group403.yuskevich.fileManager.interfaces.Command;
import ru.kpfu.itis.group403.yuskevich.fileManager.interfaces.DirChanger;

public class Copy implements Command {
	private Scanner sc;
	private DirChanger dirChanger;
    private File file, dir;
	public Copy( DirChanger dir, Scanner sc) {
		super();
		this.sc = sc;
		this.dirChanger = dir;
	}

	@Override
	public void init(String command) {
		String[] words = Tool.split(command);
		file=new File(words[1]);
		dir=new File(words[2]);
	}

	@Override
	public String keyWord() {
		return "/copy";
	}

	@Override
	public boolean check(String command) throws IllegalArgumentException {
		String[] words = Tool.split(command);
		return  Tool.checkLength(3, words);
	}
    private String rightName(String path){
    	StringBuffer copyFileName= new StringBuffer(path);
    	int i=2;
    	copyFileName=copyFileName.insert(path.lastIndexOf('.'),"_copy");
		if(new File(copyFileName.toString()).exists()){
			copyFileName=copyFileName.insert(copyFileName.toString().lastIndexOf('.'),"(1)");
		}
		if(new File(copyFileName.toString()).exists()){
			while(new File(copyFileName.toString()).exists()){
				copyFileName=copyFileName.replace(copyFileName.toString().lastIndexOf('(')+1,
						copyFileName.toString().lastIndexOf(')') , Integer.toString(i));
				i++;
			}
		}
		return copyFileName.toString();
    }
	@Override
	public boolean  execute() throws IOException {
		File copyFile;
		String path=file.getPath();
		String fileName=path.substring(path.lastIndexOf(File.separatorChar));
		File file = Tool.correctPath(path, dirChanger.getDir());
		File fileDir=new File(path.substring(0, path.lastIndexOf(File.separatorChar)));
		File copyDir=Tool.correctPath(dir.getPath(), dirChanger.getDir());
		
		if (fileDir.equals(copyDir)){
			copyFile=new File(rightName(path));
		}
		else{
			
		}
		

	return true;
}

}
